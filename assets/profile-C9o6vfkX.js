import{b as p}from"./read-DVWSykXA.js";import{a as c,h as u,d}from"./displayMessage-CqJwHQFs.js";import{b as f}from"./auth-fjUhtDne.js";import{a as y}from"./authGuard-C2GFzsuy.js";async function E(e){try{const t=await fetch(`${c}/${e}`,{method:"GET",headers:u()});return t.ok?(await t.json()).data:(console.error("Failed to fetch profile data",t.statusText),null)}catch(t){return console.error("Error fetching profile data:",t),null}}function g(e){if(!e){console.error("User data is missing");return}const t=e.banner?.url,n=e.avatar?.url,o=e.name,r=e.bio||"No bio available",a=document.getElementById("banner-image"),s=document.getElementById("profile-image"),i=document.getElementById("profile-name"),l=document.getElementById("profile-bio");i&&(i.textContent=o),a&&(t?(a.src=t,a.alt=e.banner?.alt):a.style.display="none"),s&&(n?(s.src=n,s.alt=e.avatar?.alt):s.style.display="none"),l?l.textContent=r:l.style.display="none"}function b(e,t){const n=t.data;if(!Array.isArray(n)){console.error("Expected posts.data to be an array, but got:",n),e.innerHTML='<div class="message">Invalid posts data</div>';return}if(n.length===0){e.innerHTML='<div class="message">No posts yet</div>';return}e.innerHTML="";const o=n.map(r=>h(r));typeof o[0]=="string"?e.innerHTML=o.join(""):e.append(...o)}function h(e){const{id:t,title:n}=e,o=document.createElement("a");o.classList.add("post"),o.href=`/post/?id=${t}`;const r=document.createElement("h3");return r.innerText=n,o.appendChild(r),o}async function v({avatar:e,banner:t,bio:n}){const o=u(),r={};if(n&&(r.bio=n),e&&(r.avatar={url:e.url}),t&&(r.banner={url:t.url}),Object.keys(r).length===0)throw new Error("At least one property (bio, avatar, banner) must be provided for the update.");try{const a=f(),s=await fetch(`${c}/${a}`,{method:"PUT",headers:o,body:JSON.stringify(r)});if(!s.ok){const i=await s.json();throw console.error("Failed to update profile:",i),new Error(`Failed to update profile: ${i.message}`)}return await s.json()}catch(a){throw console.error("Error updating profile:",a.message),a}}async function P(e){e.preventDefault();const t=document.getElementById("avatar-url").value,n=document.getElementById("banner-url").value,o=document.getElementById("bio").value,r={avatar:t?{url:t}:void 0,banner:n?{url:n}:void 0,bio:o||void 0};try{await v(r),d("#message","success","Profile updated succesdfully."),m()}catch(a){d("#message","error",a.message)}}y();async function I(){const e=f();if(!e){console.error("Username not found");return}try{const t=await E(e);if(!t)throw new Error("Failed to load user data");g(t);const n=document.getElementById("posts-container"),o=await p(e);b(n,o)}catch(t){console.error(t.message)}}I();function w(){document.getElementById("profile-edit-modal").style.display="block"}function m(){document.getElementById("profile-edit-modal").style.display="none"}const B=document.getElementById("edit-profile-button");B?.addEventListener("click",function(e){e.preventDefault(),w()});const L=document.getElementById("cancel-edit");L?.addEventListener("click",function(){m()});document.getElementById("profile-edit-form")?.addEventListener("submit",P);export{m as closeEditModal};
